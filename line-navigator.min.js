function LineNavigator(e,n,t){function i(e,n){var t=e.exec(n);return t?{offset:n.indexOf(t[0]),length:t[0].length,line:n}:null}var r=this;if("function"!=typeof e)throw"readChunk argument must be function(offset, length, callback)";if("function"!=typeof n)throw"decode argument must be function(buffer, callback)";t=t?t:{};var f=t.milestones?t.milestones:[],o=t.chunkSize?t.chunkSize:4096,s="\n".charCodeAt(0),a=/\r?\n/,l=function(e){for(var n=f.length-1;n>=0;n--)if(f[n].lastLine<e)return{firstLine:f[n].lastLine+1,offset:f[n].offset+f[n].length};return{firstLine:0,offset:0}},u=function(e,n,t,i){for(var r=0==f.length||f[f.length-1].offset<n,o=i-1,a=0,l=0;t>l;l++)e[l]==s&&(o++,a=l+1);var u={firstLine:i,lastLine:o,offset:n,length:a};r&&f.push(u);var c=Object.create(u);return c.place={firstLine:o+1,offset:n+a},c},c=function(e,t,i){n(e.slice(0,t),function(e){var n=e.split(a);n.length>0&&""==n[n.length-1]&&(n=n.slice(0,n.length-1)),i(n)})};r.getMilestones=function(){return f},r.readSomeLines=function(n,t){var i=l(n);e(i.offset,o,function r(f,s,a){if(f)return t(f,n);var l=o>a,h=u(s,i.offset,a,i.firstLine);if(h.firstLine<=n&&n<=h.lastLine)c(s,h.length,function(e){n!=h.firstLine&&(e=e.splice(n-h.firstLine)),t(void 0,n,e,l)});else{if(l)return t("Line "+n+" is out of index, last available: "+h.lastLine,n);i=h.place,e(i.offset,o,r)}})},r.readLines=function(e,n,t){var i=[];r.readSomeLines(e,function f(o,s,a,l){return o?t(o,e):(i=i.concat(a),i.length>=n||l?t(void 0,e,i.splice(0,n),l):void r.readSomeLines(s+a.length,f))})},r.find=function(e,n,t){r.readSomeLines(n,function f(n,o,s,a){if(n)return t(n);for(var l=0;l<s.length;l++){var u=i(e,s[l]);if(u)return t(void 0,o+l,u)}return a?t(void 0):void r.readSomeLines(o+s.length+1,f)})},r.findAll=function(e,n,t,f){var o=[];r.readSomeLines(n,function s(a,l,u,c){if(a)return f(a,n);for(var h=0;h<u.length;h++){var v=i(e,u[h]);if(v&&(v.index=l+h,o.push(v),o.length>=t))return f(void 0,n,!0,o)}return c?f(void 0,n,!1,o):void r.readSomeLines(l+u.length+1,s)})}}